---
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: jackett
    namespace: betamax
    labels:
      app: jackett
  spec:
    replicas: 1
    selector:
      matchLabels:
        app: jackett
    template:
      metadata:
        labels:
          app: jackett
      spec:
        containers:
          - name: jackett
            image: linuxserver/jackett:latest
            ports:
            - name: web
              containerPort: 9117
            volumeMounts:
            - name: config
              mountPath: "/config"
            # - name: downloads
            #   mountPath: "/downloads"
            env:
              - name: TZ
                value: Europe/Copenhagen
        volumes:
        - name: config
          persistentVolumeClaim:
            claimName: jackett-config
        # - name: downloads
        #   persistentVolumeClaim:
        #     claimName: transmission-downloads

  ---
  apiVersion: v1
  kind: Service
  metadata:
    name: jackett
    namespace: betamax
  spec:
    type: ClusterIP
    selector:
      app: jackett
    ports:
    - name: web
      protocol: TCP
      port: 9117
      targetPort: web

  ---
  apiVersion: v1
  kind: PersistentVolumeClaim
  metadata:
    name: jackett-config
    namespace: betamax
  spec:
    accessModes:
    - ReadWriteOnce
    resources:
      requests:
        storage: 100Mi

  ---
   apiVersion: traefik.containo.us/v1alpha1
   kind: IngressRoute
   metadata:
     name: jackett
     namespace: betamax
   spec:
     entrypoints:
     - https
     routes:
     - match: Host(`wcarlsen.duckdns.org`) && PathPrefix(`/jackett`)
       kind: Rule
       services:
       - name: jackett
         port: 9117
       middlewares:
       - name: traefik-auth
         namespace: traefik
     tls:
       certResolver: default
