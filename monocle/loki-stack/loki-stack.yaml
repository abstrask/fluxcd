 apiVersion: helm.fluxcd.io/v1
 kind: HelmRelease
 metadata:
   name: loki-stack
   namespace: monocle
   annotations:
     flux.weave.works/automated: "true"
 spec:
  releaseName: loki-stack
  chart:
    repository: https://grafana.github.io/loki/charts
    name: loki-stack
    version: 0.27.1
  values:
    loki:
      enabled: true
      config:
        table_manager:
          retention_deletes_enabled: true
          retention_period: 168h
      persistence:
        enabled: true
        size: 10Gi

    grafana:
      enabled: true
      sidecar:
        datasources:
          enabled: true
      admin:
        existingSecret: "loki-stack"
        userKey: admin-user
        passwordKey: admin-password
      persistence:
        enabled: true
        size: 1Gi

    prometheus:
      enabled: true
      pushgateway:
        enabled: false
        server:
          retention: "7d"

    promtail:
      enabled: true